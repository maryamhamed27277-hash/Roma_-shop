<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Roma Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0; padding: 0;
      background: #f5f6fa;
    }
    header {
      background: #6a11cb;
      color: #fff; padding: 20px;
      text-align: center; font-size: 24px;
      font-weight: bold; box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .container {
      max-width: 1200px; margin: 20px auto; padding: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
      gap: 20px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      text-align: center; padding: 25px;
      transition: 0.3s;
    }
    .card:hover { transform: translateY(-5px); }
    .card h3 { margin: 0; color: #6a11cb; }
    .card p { font-size: 18px; margin: 10px 0; }
    .card button {
      padding: 10px 20px; border: none; border-radius: 8px;
      background: #2575fc; color: #fff; font-weight: bold;
      cursor: pointer; transition: 0.3s;
    }
    .card button:hover { background: #1554c0; }
    /* Modal */
    .modal {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.6); display: none;
      align-items: center; justify-content: center;
    }
    .modal-content {
      background: #fff; padding: 25px; border-radius: 12px;
      width: 90%; max-width: 400px; text-align: center;
    }
    .modal input, .modal button {
      width: 90%; margin: 8px 0; padding: 12px;
      border-radius: 8px; border: 1px solid #ccc;
    }
    .modal button {
      background: #6a11cb; color: #fff; border: none;
    }
    .hidden { display: none; }
    /* Admin */
    table {
      width: 100%; border-collapse: collapse; margin-top: 20px;
    }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    th { background: #6a11cb; color: #fff; }
    .status.pending { color: #e67e22; font-weight: bold; }
    .status.done { color: #27ae60; font-weight: bold; }
  </style>
</head>
<body>
  <header>Roma Shop</header>

  <!-- تسجيل الدخول -->
  <div class="container" id="auth-section">
    <h2>تسجيل الدخول</h2>
    <input type="email" id="loginEmail" placeholder="البريد الإلكتروني">
    <input type="password" id="loginPassword" placeholder="كلمة المرور">
    <button onclick="login()">دخول</button>
  </div>

  <!-- المتجر -->
  <div class="container hidden" id="shop-section">
    <h2>اختر الباقة</h2>
    <div class="grid" id="packages"></div>
    <button onclick="logout()">تسجيل خروج</button>
  </div>

  <!-- نافذة الطلب -->
  <div class="modal" id="orderModal">
    <div class="modal-content">
      <h3>إكمال الطلب</h3>
      <p>ادفع على: <b>01031090116</b></p>
      <input type="text" id="instaUser" placeholder="اسم مستخدم إنستجرام">
      <input type="text" id="phone" placeholder="رقم الموبايل">
      <input type="file" id="receipt">
      <button onclick="submitOrder()">إرسال الطلب</button>
      <button onclick="closeModal()">إغلاق</button>
    </div>
  </div>

  <!-- لوحة التحكم -->
  <div class="container hidden" id="admin-section">
    <h2>لوحة التحكم</h2>
    <table>
      <thead>
        <tr>
          <th>المستخدم</th>
          <th>الباقة</th>
          <th>إنستجرام</th>
          <th>الهاتف</th>
          <th>الحالة</th>
          <th>إجراء</th>
        </tr>
      </thead>
      <tbody id="ordersTable"></tbody>
    </table>
    <button onclick="logout()">تسجيل خروج</button>
  </div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCg7c0q2nKJHykS2Qpp0ldoutG_29OBYkU",
    authDomain: "romashop-62bf8.firebaseapp.com",
    projectId: "romashop-62bf8",
    storageBucket: "romashop-62bf8.appspot.com",
    messagingSenderId: "830956550573",
    appId: "1:830956550573:web:8f40bedb6d05c87eecc924",
    measurementId: "G-6KWHET1BWV"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const adminEmail = "admin@romashop.com"; // إيميل الأدمن اللي تعمله في Firebase
  const packages = [
    {followers:50, price:10},
    {followers:100, price:20},
    {followers:250, price:50},
    {followers:500, price:100},
    {followers:1000, price:200}
  ];
  let selectedPackage = null;

  // تسجيل الدخول
  function login(){
    const email=document.getElementById("loginEmail").value;
    const pass=document.getElementById("loginPassword").value;
    auth.signInWithEmailAndPassword(email,pass).then(()=>{
      document.getElementById("auth-section").classList.add("hidden");
      if(email===adminEmail){ loadOrders(); document.getElementById("admin-section").classList.remove("hidden"); }
      else { renderPackages(); document.getElementById("shop-section").classList.remove("hidden"); }
    }).catch(e=>alert(e.message));
  }

  function logout(){auth.signOut().then(()=>location.reload());}

  function renderPackages(){
    const div=document.getElementById("packages"); div.innerHTML="";
    packages.forEach(p=>{
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`<h3>${p.followers} متابع</h3><p>${p.price} جنيه</p><button>اطلب الآن</button>`;
      card.querySelector("button").onclick=()=>{
        selectedPackage=p;
        document.getElementById("orderModal").style.display="flex";
      };
      div.appendChild(card);
    });
  }

  function closeModal(){document.getElementById("orderModal").style.display="none";}

  async function submitOrder(){
    const insta=document.getElementById("instaUser").value;
    const phone=document.getElementById("phone").value;
    const file=document.getElementById("receipt").files[0];
    if(!insta||!phone||!file){alert("املأ جميع البيانات");return;}

    const ref=storage.ref("receipts/"+Date.now()+"_"+file.name);
    await ref.put(file);
    const url=await ref.getDownloadURL();

    await db.collection("orders").add({
      user:auth.currentUser.email,
      package:selectedPackage,
      instaUser:insta, phone, receipt:url,
      status:"قيد المراجعة", createdAt:new Date()
    });
    alert("تم إرسال الطلب بنجاح");
    closeModal();
  }

  function loadOrders(){
    db.collection("orders").orderBy("createdAt","desc").onSnapshot(snap=>{
      const tbody=document.getElementById("ordersTable"); tbody.innerHTML="";
      snap.forEach(doc=>{
        const d=doc.data();
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${d.user}</td>
          <td>${d.package.followers} - ${d.package.price}ج</td>
          <td>${d.instaUser}</td>
          <td>${d.phone}</td>
          <td class="status ${d.status==="قيد المراجعة"?"pending":"done"}">${d.status}</td>
          <td>${d.status==="قيد المراجعة"?`<button onclick="markDone('${doc.id}')">تم</button>`:""}</td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  function markDone(id){
    db.collection("orders").doc(id).update({status:"تم الاستلام"});
  }
</script>
</body>
</html>
