<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Roma Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #8e44ad, #3498db);
      margin: 0; padding: 0;
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
    }
    header {
      background: rgba(0,0,0,0.6);
      color: #fff; padding: 15px; font-size: 24px; font-weight: bold;
      text-align: center; width: 100%;
    }
    .container {
      max-width: 600px; width: 90%;
      background: #fff; margin: 20px auto; padding: 25px;
      border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      text-align: center;
      animation: fadeIn 0.5s ease-in-out;
    }
    input, button {
      width: 90%; padding: 12px; margin: 10px 0;
      border-radius: 8px; border: 1px solid #ccc; font-size: 16px;
    }
    button {
      background: #8e44ad; color: #fff; font-weight: bold;
      border: none; cursor: pointer; transition: 0.3s;
    }
    button:hover { background: #732d91; transform: scale(1.05); }
    .hidden { display: none; }
    .packages { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
    .package {
      flex: 1 1 40%; min-width: 120px;
      border-radius: 10px; padding: 20px;
      background: #f9f9f9; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer; transition: 0.3s;
    }
    .package:hover { background: #f0e6f9; transform: translateY(-5px); }
    .package h4 { margin: 0; color: #8e44ad; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; }
    th { background: #eee; }
    .status { padding: 4px 8px; border-radius: 6px; font-size: 13px; }
    .pending { background: #f39c12; color: #fff; }
    .done { background: #27ae60; color: #fff; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
  </style>
</head>
<body>
  <header>Roma Shop</header>

  <!-- Login/Register -->
  <div class="container" id="auth-section">
    <h3>تسجيل الدخول</h3>
    <input type="email" id="loginEmail" placeholder="البريد الإلكتروني">
    <input type="password" id="loginPassword" placeholder="كلمة المرور">
    <button onclick="login()">تسجيل الدخول</button>
    <p>ليس لديك حساب؟ <a href="#" onclick="showRegister()">سجل الآن</a></p>
  </div>

  <div class="container hidden" id="register-section">
    <h3>تسجيل حساب جديد</h3>
    <input type="email" id="regEmail" placeholder="البريد الإلكتروني">
    <input type="password" id="regPassword" placeholder="كلمة المرور">
    <button onclick="register()">تسجيل</button>
    <p><a href="#" onclick="showLogin()">لديك حساب؟ سجل دخول</a></p>
  </div>

  <!-- User Shop -->
  <div class="container hidden" id="shop-section">
    <h3>اختر الباقة</h3>
    <div class="packages" id="packages"></div>
    <button onclick="logout()">تسجيل خروج</button>
  </div>

  <!-- Order Form -->
  <div class="container hidden" id="order-section">
    <h3>إكمال الطلب</h3>
    <p>قم بالتحويل على رقم فودافون كاش: <b>01031090116</b></p>
    <input type="text" id="instaUser" placeholder="اسم مستخدم إنستجرام">
    <input type="text" id="phone" placeholder="رقم الموبايل">
    <input type="file" id="receipt">
    <button onclick="submitOrder()">إرسال الطلب</button>
  </div>

  <!-- Admin Panel -->
  <div class="container hidden" id="admin-section">
    <h3>لوحة التحكم</h3>
    <table>
      <thead>
        <tr>
          <th>المستخدم</th>
          <th>الباقة</th>
          <th>إنستجرام</th>
          <th>هاتف</th>
          <th>الحالة</th>
          <th>إجراء</th>
        </tr>
      </thead>
      <tbody id="ordersTable"></tbody>
    </table>
    <button onclick="logout()">تسجيل خروج</button>
  </div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCg7c0q2nKJHykS2Qpp0ldoutG_29OBYkU",
    authDomain: "romashop-62bf8.firebaseapp.com",
    projectId: "romashop-62bf8",
    storageBucket: "romashop-62bf8.appspot.com",
    messagingSenderId: "830956550573",
    appId: "1:830956550573:web:8f40bedb6d05c87eecc924",
    measurementId: "G-6KWHET1BWV"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const adminEmail = "admin@romashop.com"; // الأدمن اللي عملته في Firebase

  const packages = [
    {followers:50, price:10},
    {followers:100, price:20},
    {followers:200, price:40},
    {followers:500, price:100},
    {followers:1000, price:200}
  ];

  let selectedPackage = null;

  function showRegister(){document.getElementById("auth-section").classList.add("hidden");document.getElementById("register-section").classList.remove("hidden");}
  function showLogin(){document.getElementById("register-section").classList.add("hidden");document.getElementById("auth-section").classList.remove("hidden");}

  function login(){
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    auth.signInWithEmailAndPassword(email, password).then(()=>{
      if(email===adminEmail){
        loadOrders();
        document.getElementById("admin-section").classList.remove("hidden");
      }else{
        renderPackages();
        document.getElementById("shop-section").classList.remove("hidden");
      }
      document.getElementById("auth-section").classList.add("hidden");
    }).catch(e=>alert(e.message));
  }

  function register(){
    const email = document.getElementById("regEmail").value;
    const password = document.getElementById("regPassword").value;
    auth.createUserWithEmailAndPassword(email,password).then(()=>{
      alert("تم التسجيل بنجاح، قم بتسجيل الدخول الآن");
      showLogin();
    }).catch(e=>alert(e.message));
  }

  function logout(){auth.signOut().then(()=>location.reload());}

  function renderPackages(){
    const div = document.getElementById("packages");
    div.innerHTML="";
    packages.forEach(p=>{
      const el = document.createElement("div");
      el.className="package";
      el.innerHTML=`<h4>${p.followers} متابع</h4><p>${p.price} جنيه</p>`;
      el.onclick=()=>{selectedPackage=p;document.getElementById("shop-section").classList.add("hidden");document.getElementById("order-section").classList.remove("hidden");};
      div.appendChild(el);
    });
  }

  async function submitOrder(){
    const instaUser=document.getElementById("instaUser").value;
    const phone=document.getElementById("phone").value;
    const file=document.getElementById("receipt").files[0];
    let fileURL="";
    if(file){
      const ref=storage.ref("receipts/"+Date.now()+"_"+file.name);
      await ref.put(file);
      fileURL=await ref.getDownloadURL();
    }
    await db.collection("orders").add({
      user:auth.currentUser.email,
      package:selectedPackage,
      instaUser, phone,
      receipt:fileURL,
      status:"قيد المراجعة"
    });
    alert("تم إرسال الطلب بنجاح");
    location.reload();
  }

  function loadOrders(){
    db.collection("orders").onSnapshot(snap=>{
      const tbody=document.getElementById("ordersTable");
      tbody.innerHTML="";
      snap.forEach(doc=>{
        const data=doc.data();
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${data.user}</td>
          <td>${data.package.followers} متابع - ${data.package.price}ج</td>
          <td>${data.instaUser}</td>
          <td>${data.phone}</td>
          <td><span class="status ${data.status==="قيد المراجعة"?"pending":"done"}">${data.status}</span></td>
          <td>${data.status==="قيد المراجعة"?`<button onclick="markDone('${doc.id}')">اكتمل</button>`:""}</td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  function markDone(id){
    db.collection("orders").doc(id).update({status:"تم الاستلام"});
  }
</script>
</body>
</html>
