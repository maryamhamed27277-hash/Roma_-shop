<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Roma Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      margin: 0; padding: 0;
      min-height: 100vh; display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
    }
    header {
      background: rgba(0,0,0,0.6);
      color: #fff; padding: 20px; font-size: 26px; font-weight: bold;
      text-align: center; width: 100%; box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    .container {
      max-width: 500px; width: 90%;
      background: #fff; margin: 20px auto; padding: 25px;
      border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      text-align: center; animation: fadeIn 0.6s ease;
    }
    input, button {
      width: 90%; padding: 12px; margin: 10px 0;
      border-radius: 8px; border: 1px solid #ccc; font-size: 16px;
    }
    button {
      background: #6a11cb; color: #fff; font-weight: bold;
      border: none; cursor: pointer; transition: 0.3s;
    }
    button:hover { background: #4a0f91; transform: scale(1.05); }
    .hidden { display: none; }
    .packages { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
    .package {
      flex: 1 1 40%; min-width: 150px;
      border-radius: 12px; padding: 20px;
      background: linear-gradient(135deg, #fdfbfb, #ebedee);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      cursor: pointer; transition: 0.3s;
    }
    .package:hover { background: #f0e6f9; transform: translateY(-6px); }
    .package h4 { margin: 0; color: #6a11cb; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; }
    th { background: #eee; }
    .status { padding: 4px 8px; border-radius: 6px; font-size: 13px; }
    .pending { background: #f39c12; color: #fff; }
    .done { background: #27ae60; color: #fff; }
    .toast {
      position: fixed; bottom: 20px; right: 20px;
      background: #333; color: #fff; padding: 12px 20px;
      border-radius: 8px; opacity: 0; pointer-events: none;
      transition: 0.5s;
    }
    .toast.show { opacity: 1; pointer-events: auto; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
  </style>
</head>
<body>
  <header>Roma Shop</header>

  <!-- Login/Register -->
  <div class="container" id="auth-section">
    <h3>تسجيل الدخول</h3>
    <input type="email" id="loginEmail" placeholder="البريد الإلكتروني">
    <input type="password" id="loginPassword" placeholder="كلمة المرور">
    <button onclick="login()">تسجيل الدخول</button>
    <p>ليس لديك حساب؟ <a href="#" onclick="showRegister()">سجل الآن</a></p>
  </div>

  <div class="container hidden" id="register-section">
    <h3>تسجيل حساب جديد</h3>
    <input type="email" id="regEmail" placeholder="البريد الإلكتروني">
    <input type="password" id="regPassword" placeholder="كلمة المرور">
    <button onclick="register()">تسجيل</button>
    <p><a href="#" onclick="showLogin()">لديك حساب؟ سجل دخول</a></p>
  </div>

  <!-- User Shop -->
  <div class="container hidden" id="shop-section">
    <h3>اختر الباقة</h3>
    <div class="packages" id="packages"></div>
    <button onclick="logout()">تسجيل خروج</button>
  </div>

  <!-- Order Form -->
  <div class="container hidden" id="order-section">
    <h3>إكمال الطلب</h3>
    <p>قم بالتحويل على رقم فودافون كاش: <b>01031090116</b></p>
    <input type="text" id="instaUser" placeholder="اسم مستخدم إنستجرام">
    <input type="text" id="phone" placeholder="رقم الموبايل">
    <input type="file" id="receipt">
    <button onclick="submitOrder()">إرسال الطلب</button>
  </div>

  <!-- Admin Panel -->
  <div class="container hidden" id="admin-section">
    <h3>لوحة التحكم</h3>
    <table>
      <thead>
        <tr>
          <th>المستخدم</th>
          <th>الباقة</th>
          <th>إنستجرام</th>
          <th>هاتف</th>
          <th>الحالة</th>
          <th>إجراء</th>
        </tr>
      </thead>
      <tbody id="ordersTable"></tbody>
    </table>
    <button onclick="logout()">تسجيل خروج</button>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCg7c0q2nKJHykS2Qpp0ldoutG_29OBYkU",
    authDomain: "romashop-62bf8.firebaseapp.com",
    projectId: "romashop-62bf8",
    storageBucket: "romashop-62bf8.appspot.com",
    messagingSenderId: "830956550573",
    appId: "1:830956550573:web:8f40bedb6d05c87eecc924",
    measurementId: "G-6KWHET1BWV"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const adminEmail = "admin@romashop.com"; // أدمن انت عامل حسابه في Firebase
  const packages = [
    {followers:50, price:10},
    {followers:100, price:20},
    {followers:200, price:40},
    {followers:500, price:100},
    {followers:1000, price:200}
  ];
  let selectedPackage = null;

  // Helpers
  function toast(msg, success=false){
    const t=document.getElementById("toast");
    t.innerText=msg;
    t.style.background=success?"#27ae60":"#e74c3c";
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"),3000);
  }

  function showRegister(){document.getElementById("auth-section").classList.add("hidden");document.getElementById("register-section").classList.remove("hidden");}
  function showLogin(){document.getElementById("register-section").classList.add("hidden");document.getElementById("auth-section").classList.remove("hidden");}

  function login(){
    const email=document.getElementById("loginEmail").value;
    const password=document.getElementById("loginPassword").value;
    auth.signInWithEmailAndPassword(email,password).then(()=>{
      if(email===adminEmail){
        loadOrders();
        document.getElementById("admin-section").classList.remove("hidden");
      }else{
        renderPackages();
        document.getElementById("shop-section").classList.remove("hidden");
      }
      document.getElementById("auth-section").classList.add("hidden");
    }).catch(e=>toast(e.message));
  }

  function register(){
    const email=document.getElementById("regEmail").value;
    const password=document.getElementById("regPassword").value;
    if(password.length<6){toast("كلمة المرور قصيرة جدًا");return;}
    auth.createUserWithEmailAndPassword(email,password).then(()=>{
      toast("تم التسجيل بنجاح، سجل دخول الآن",true);
      showLogin();
    }).catch(e=>toast(e.message));
  }

  function logout(){auth.signOut().then(()=>location.reload());}

  function renderPackages(){
    const div=document.getElementById("packages");
    div.innerHTML="";
    packages.forEach(p=>{
      const el=document.createElement("div");
      el.className="package";
      el.innerHTML=`<h4>${p.followers} متابع</h4><p>${p.price} جنيه</p>`;
      el.onclick=()=>{
        selectedPackage=p;
        document.getElementById("shop-section").classList.add("hidden");
        document.getElementById("order-section").classList.remove("hidden");
      };
      div.appendChild(el);
    });
  }

  async function submitOrder(){
    const instaUser=document.getElementById("instaUser").value.trim();
    const phone=document.getElementById("phone").value.trim();
    const file=document.getElementById("receipt").files[0];

    if(!instaUser||!phone||!file){toast("من فضلك املأ جميع الحقول");return;}

    let fileURL="";
    try{
      const ref=storage.ref("receipts/"+Date.now()+"_"+file.name);
      await ref.put(file);
      fileURL=await ref.getDownloadURL();
    }catch(err){toast("فشل رفع الصورة");return;}

    await db.collection("orders").add({
      user:auth.currentUser.email,
      package:selectedPackage,
      instaUser, phone,
      receipt:fileURL,
      status:"قيد المراجعة",
      createdAt:new Date()
    });
    toast("تم إرسال الطلب بنجاح",true);
    setTimeout(()=>location.reload(),1500);
  }

  function loadOrders(){
    db.collection("orders").orderBy("createdAt","desc").onSnapshot(snap=>{
      const tbody=document.getElementById("ordersTable");
      tbody.innerHTML="";
      snap.forEach(doc=>{
        const data=doc.data();
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${data.user}</td>
          <td>${data.package.followers} متابع - ${data.package.price}ج</td>
          <td>${data.instaUser}</td>
          <td>${data.phone}</td>
          <td><span class="status ${data.status==="قيد المراجعة"?"pending":"done"}">${data.status}</span></td>
          <td>${data.status==="قيد المراجعة"?`<button onclick="markDone('${doc.id}')">اكتمل</button>`:""}</td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  function markDone(id){
    db.collection("orders").doc(id).update({status:"تم الاستلام"}).then(()=>toast("تم تحديث الحالة",true));
  }
</script>
</body>
</html>
