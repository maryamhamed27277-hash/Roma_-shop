<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Roma Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <style>
    body { margin:0; font-family:'Cairo',sans-serif; background:#f3f4f6; }
    header {
      background: linear-gradient(to right,#6a11cb,#2575fc);
      padding:15px; color:#fff; text-align:center; font-size:20px;
    }
    .container { padding:20px; max-width:1100px; margin:auto; }
    h2 { text-align:center; margin:15px 0; }
    .grid {
      display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:20px; margin-top:20px;
    }
    .card {
      background:#fff; border-radius:14px; padding:20px; text-align:center;
      box-shadow:0 4px 10px rgba(0,0,0,0.1); transition:0.3s;
    }
    .card:hover { transform:translateY(-5px); }
    .card h3 { color:#6a11cb; }
    .card button {
      background:linear-gradient(to right,#6a11cb,#2575fc);
      color:#fff;border:none;padding:10px 20px;margin-top:10px;
      border-radius:8px;cursor:pointer;font-weight:bold;
    }
    .modal {
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;
    }
    .modal-content {
      background:#fff;padding:20px;border-radius:14px;max-width:400px;width:90%;
      text-align:center;
    }
    .modal input, .modal button { width:90%;margin:8px 0;padding:10px;border-radius:8px;border:1px solid #ccc; }
    .modal button { background:#6a11cb;color:#fff;border:none; }
    /* لوحة التحكم */
    #adminSection { display:none; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    table,th,td { border:1px solid #ccc; }
    th,td { padding:10px; text-align:center; }
    .status-btn {
      padding:6px 12px;border:none;border-radius:6px;cursor:pointer;
      background:#2575fc;color:#fff;
    }
  </style>
</head>
<body>
  <header>Roma Shop</header>

  <!-- تسجيل دخول الأدمن -->
  <div class="container" id="loginSection">
    <h2>تسجيل دخول الأدمن</h2>
    <input type="email" id="adminEmail" placeholder="البريد">
    <input type="password" id="adminPass" placeholder="كلمة المرور">
    <button onclick="adminLogin()">دخول</button>
  </div>

  <!-- المتجر -->
  <div class="container" id="shopSection">
    <h2>اختر الباقة المناسبة</h2>
    <div class="grid" id="packages"></div>
  </div>

  <!-- نافذة الطلب -->
  <div class="modal" id="orderModal">
    <div class="modal-content">
      <h3>إكمال الطلب</h3>
      <p>ادفع على: <b>01031090116</b></p>
      <input type="text" id="instaUser" placeholder="اسم مستخدم إنستجرام">
      <input type="text" id="phone" placeholder="رقم الموبايل">
      <input type="file" id="receipt">
      <button onclick="submitOrder()">إرسال الطلب</button>
      <button onclick="closeModal()">إغلاق</button>
    </div>
  </div>

  <!-- لوحة التحكم -->
  <div class="container" id="adminSection">
    <h2>لوحة تحكم الأدمن</h2>
    <table>
      <thead>
        <tr><th>المستخدم</th><th>الباقة</th><th>الهاتف</th><th>الإيصال</th><th>الحالة</th><th>تحكم</th></tr>
      </thead>
      <tbody id="ordersTable"></tbody>
    </table>
    <button onclick="logout()">تسجيل خروج</button>
  </div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCg7c0q2nKJHykS2Qpp0ldoutG_29OBYkU",
    authDomain: "romashop-62bf8.firebaseapp.com",
    projectId: "romashop-62bf8",
    storageBucket: "romashop-62bf8.appspot.com",
    messagingSenderId: "830956550573",
    appId: "1:830956550573:web:8f40bedb6d05c87eecc924"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();
  const auth = firebase.auth();

  // المتجر
  const packages = [
    {followers:50, price:10},
    {followers:100, price:20},
    {followers:250, price:45},
    {followers:500, price:85},
    {followers:1000, price:150}
  ];
  let selectedPackage=null;

  function renderPackages(){
    const div=document.getElementById("packages"); div.innerHTML="";
    packages.forEach(p=>{
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`<h3>${p.followers} متابع</h3>
        <p>${p.price} جنيه</p>
        <button>اختر الباقة</button>`;
      card.querySelector("button").onclick=()=>{
        selectedPackage=p;
        document.getElementById("orderModal").style.display="flex";
      };
      div.appendChild(card);
    });
  }
  renderPackages();

  function closeModal(){document.getElementById("orderModal").style.display="none";}

  async function submitOrder(){
    const insta=document.getElementById("instaUser").value;
    const phone=document.getElementById("phone").value;
    const file=document.getElementById("receipt").files[0];
    if(!insta||!phone||!file){alert("املأ جميع البيانات");return;}
    const ref=storage.ref("receipts/"+Date.now()+"_"+file.name);
    await ref.put(file);
    const url=await ref.getDownloadURL();
    await db.collection("orders").add({
      package:selectedPackage,
      instaUser:insta, phone, receipt:url,
      status:"قيد المراجعة", createdAt:new Date()
    });
    alert("✅ تم إرسال الطلب بنجاح");
    closeModal();
  }

  // تسجيل دخول الأدمن
  function adminLogin(){
    const email=document.getElementById("adminEmail").value;
    const pass=document.getElementById("adminPass").value;
    auth.signInWithEmailAndPassword(email,pass)
    .then(()=>{
      if(email==="admin@romashop.com"){ 
        document.getElementById("loginSection").style.display="none";
        document.getElementById("shopSection").style.display="none";
        document.getElementById("adminSection").style.display="block";
        loadOrders();
      } else { alert("ليس لديك صلاحية الأدمن"); }
    }).catch(e=>alert("خطأ: "+e.message));
  }

  function logout(){
    auth.signOut();
    document.getElementById("adminSection").style.display="none";
    document.getElementById("loginSection").style.display="block";
    document.getElementById("shopSection").style.display="block";
  }

  function loadOrders(){
    db.collection("orders").orderBy("createdAt","desc").onSnapshot(snap=>{
      const tbody=document.getElementById("ordersTable");
      tbody.innerHTML="";
      snap.forEach(doc=>{
        const d=doc.data();
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${d.instaUser}</td>
          <td>${d.package.followers} متابع - ${d.package.price}ج</td>
          <td>${d.phone}</td>
          <td><a href="${d.receipt}" target="_blank">عرض</a></td>
          <td>${d.status}</td>
          <td><button class="status-btn" onclick="updateStatus('${doc.id}')">اكتمال</button></td>`;
        tbody.appendChild(tr);
      });
    });
  }

  function updateStatus(id){
    db.collection("orders").doc(id).update({status:"مكتمل"});
  }
</script>
</body>
</html>
