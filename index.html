<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Roma Shop - متابعات إنستجرام</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet"/>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Tajawal', sans-serif; }
        :root {
            --primary: #8A2BE2; --primary-dark: #6A0DAD; --secondary: #FF6B8B; --secondary-dark: #E84565;
            --accent: #00D4FF; --light: #F8F9FA; --dark: #1A1A2E; --success: #00C9A7; --warning: #FFC75F; --danger: #FF8066;
        }
        body {
            background: linear-gradient(135deg, var(--dark) 0%, #16213E 100%);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
        }
        .container { max-width:1200px; margin:0 auto; padding:0 20px; }
        header { display:flex; justify-content:space-between; align-items:center; padding:20px 0; border-bottom:1px solid rgba(255,255,255,0.1); }
        .logo { font-size:28px; font-weight:800; background: linear-gradient(45deg, var(--primary), var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        nav ul { display:flex; list-style:none; gap:20px; align-items:center; }
        nav a { color:var(--light); text-decoration:none; padding:10px 20px; border-radius:25px; transition:0.3s; cursor:pointer; }
        nav a:hover { background: var(--primary); }
        .hero { text-align:center; padding:80px 0; }
        .hero h1 { font-size:3.2rem; margin-bottom:20px; background:linear-gradient(to right,var(--accent),var(--secondary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .btn {
            background: linear-gradient(45deg,var(--primary),var(--secondary)); color:white; padding:12px 28px; border:none; border-radius:30px;
            font-size:16px; font-weight:700; cursor:pointer; transition:0.25s; display:inline-block; text-decoration:none;
        }
        .btn:hover { transform:translateY(-3px); box-shadow:0 10px 25px rgba(138,43,226,0.25); }
        .features{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:30px; margin:60px 0; }
        .feature-card{ background:rgba(255,255,255,0.06); padding:25px; border-radius:18px; text-align:center; border:1px solid rgba(255,255,255,0.08); backdrop-filter: blur(8px); }
        .feature-card i{ font-size:44px; margin-bottom:15px; background:linear-gradient(45deg,var(--accent),var(--secondary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .packages{ margin:50px 0; }
        .section-title{ text-align:center; font-size:2rem; margin-bottom:30px; }
        .package-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:20px; }
        .package-card{ background:rgba(255,255,255,0.06); padding:20px; border-radius:16px; text-align:center; border:1px solid rgba(255,255,255,0.08); backdrop-filter: blur(8px); transition:0.3s; }
        .package-card:hover{ transform:translateY(-8px); }
        .package-amount{ font-size:2.4rem; font-weight:800; background:linear-gradient(45deg,var(--accent),var(--secondary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:6px; }
        .package-price{ font-size:1.6rem; font-weight:700; margin:10px 0; }
        /* pages */
        .page{ display:none; }
        .active{ display:block; }
        .login-form, .signup-form, .payment-page { background: rgba(255,255,255,0.06); padding:30px; border-radius:16px; max-width:520px; margin:40px auto; border:1px solid rgba(255,255,255,0.08); backdrop-filter: blur(8px); }
        .form-group{ margin-bottom:14px; }
        .form-control{ width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.14); background:rgba(255,255,255,0.03); color:var(--light); font-size:15px; }
        .form-control::placeholder{ color: rgba(255,255,255,0.5); }
        .order-item{ background:rgba(255,255,255,0.04); padding:16px; margin-bottom:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.06); }
        .status-pending{ background:rgba(255,199,95,0.15); color:var(--warning); padding:5px 12px; border-radius:20px; font-size:13px; display:inline-block; }
        .status-completed{ background:rgba(0,201,167,0.12); color:var(--success); padding:5px 12px; border-radius:20px; font-size:13px; display:inline-block; }
        .small-muted{ opacity:0.75; font-size:0.95rem; }
        footer{ text-align:center; padding:30px 0; opacity:0.6; }
        @media (max-width:600px){ .hero h1{ font-size:2rem; } nav ul{ gap:8px; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- Home Page -->
        <div id="homePage" class="page active">
            <header>
                <div class="logo"><i class="fas fa-crown"></i> Roma Shop</div>
                <nav>
                    <ul>
                        <li><a onclick="showPage('homePage')">الرئيسية</a></li>
                        <li><a onclick="goToOrders()">طلباتي</a></li>
                        <li><a id="navLogin" onclick="showPage('loginPage')">تسجيل الدخول</a></li>
                        <li><a id="navSignup" onclick="showPage('signupPage')">سجل الآن</a></li>
                        <li><a id="navLogout" style="display:none;" onclick="logoutUser()">تسجيل الخروج</a></li>
                    </ul>
                </nav>
            </header>

            <section class="hero">
                <h1>مصدرك الموثوق لزيادة المتابعين</h1>
                <p class="small-muted" style="margin-bottom:18px;">احصل على متابعين حقيقيين ونشطين لحساب إنستجرامك بأفضل الأسعار</p>
                <a class="btn" href="#packages" onclick="showPage('homePage'); setTimeout(()=>{document.getElementById('packages').scrollIntoView({behavior:'smooth'});},50)"><i class="fas fa-shopping-cart"></i> ابدأ الآن</a>
            </section>

            <section class="features">
                <div class="feature-card"><i class="fas fa-shield-alt"></i><h3>ضمان الجودة</h3><p class="small-muted">متابعين حقيقيين بنسبة 100% مع ضمان استرجاع الأموال</p></div>
                <div class="feature-card"><i class="fas fa-bolt"></i><h3>تسليم فوري</h3><p class="small-muted">تبدأ خدمتنا فور تأكيد الدفع، خلال 24-48 ساعة</p></div>
                <div class="feature-card"><i class="fas fa-lock"></i><h3>آمن تماماً</h3><p class="small-muted">خدمتنا آمنة ولا تحتاج لكلمة مرور حسابك</p></div>
            </section>

            <section class="packages" id="packages">
                <h2 class="section-title">اختر الباقة المناسبة</h2>
                <div class="package-grid">
                    <div class="package-card">
                        <div class="package-amount">50</div>
                        <div class="small-muted" style="margin-bottom:10px;">متابع إنستجرام</div>
                        <div class="package-price">10 جنيه</div>
                        <button class="btn" onclick="selectPackage(50,10)"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                    </div>
                    <div class="package-card">
                        <div class="package-amount">100</div>
                        <div class="small-muted" style="margin-bottom:10px;">متابع إنستجرام</div>
                        <div class="package-price">20 جنيه</div>
                        <button class="btn" onclick="selectPackage(100,20)"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                    </div>
                    <div class="package-card">
                        <div class="package-amount">250</div>
                        <div class="small-muted" style="margin-bottom:10px;">متابع إنستجرام</div>
                        <div class="package-price">45 جنيه</div>
                        <button class="btn" onclick="selectPackage(250,45)"><i class="fas fa-bolt"></i> اختر الباقة</button>
                    </div>
                    <div class="package-card">
                        <div class="package-amount">500</div>
                        <div class="small-muted" style="margin-bottom:10px;">متابع إنستجرام</div>
                        <div class="package-price">85 جنيه</div>
                        <button class="btn" onclick="selectPackage(500,85)"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                    </div>
                    <div class="package-card">
                        <div class="package-amount">1000</div>
                        <div class="small-muted" style="margin-bottom:10px;">متابع إنستجرام</div>
                        <div class="package-price">150 جنيه</div>
                        <button class="btn" onclick="selectPackage(1000,150)"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Login Page -->
        <div id="loginPage" class="page">
            <header>
                <div class="logo"><i class="fas fa-crown"></i> Roma Shop</div>
            </header>
            <div class="login-form">
                <h2 style="margin-bottom:10px;">تسجيل الدخول</h2>
                <div class="form-group"><input type="email" id="loginEmail" class="form-control" placeholder="البريد الإلكتروني"></div>
                <div class="form-group"><input type="password" id="loginPassword" class="form-control" placeholder="كلمة المرور"></div>
                <button class="btn" style="width:100%;" onclick="loginUser()">تسجيل الدخول</button>
                <p style="margin-top:12px;">ما عندكش حساب؟ <span style="color:var(--accent);cursor:pointer" onclick="showPage('signupPage')">سجل الآن</span></p>
            </div>
        </div>

        <!-- Signup Page -->
        <div id="signupPage" class="page">
            <header>
                <div class="logo"><i class="fas fa-crown"></i> Roma Shop</div>
            </header>
            <div class="signup-form">
                <h2 style="margin-bottom:10px;">تسجيل حساب جديد</h2>
                <div class="form-group"><input type="email" id="signupEmail" class="form-control" placeholder="البريد الإلكتروني"></div>
                <div class="form-group"><input type="password" id="signupPassword" class="form-control" placeholder="كلمة المرور"></div>
                <div class="form-group"><input type="password" id="signupPasswordConfirm" class="form-control" placeholder="تأكيد كلمة المرور"></div>
                <button class="btn" style="width:100%;" onclick="signupUser()">إنشاء حساب</button>
                <p style="margin-top:12px;">عندك حساب؟ <span style="color:var(--accent);cursor:pointer" onclick="showPage('loginPage')">سجل دخول</span></p>
            </div>
        </div>

        <!-- Orders Page -->
        <div id="ordersPage" class="page">
            <header>
                <div class="logo"><i class="fas fa-crown"></i> Roma Shop</div>
            </header>
            <h2 class="section-title">طلباتي</h2>
            <div id="ordersList" style="max-width:900px;margin:0 auto 40px;"></div>
        </div>

        <!-- Payment Page -->
        <div id="paymentPage" class="page">
            <header><div class="logo"><i class="fas fa-crown"></i> Roma Shop</div></header>
            <div class="payment-page">
                <h2 style="text-align:center;margin-bottom:18px;">إتمام الطلب</h2>
                <div style="background:rgba(255,255,255,0.03);padding:12px;border-radius:10px;margin-bottom:12px;">
                    <strong>باقة مختارة:</strong> <span id="selectedPackageInfo">باقة 100 متابع - 20 جنيه</span>
                </div>
                <div class="form-group"><label class="small-muted" style="display:block;margin-bottom:6px;">اسم المستخدم في إنستجرام</label><input type="text" id="username" class="form-control" placeholder="اسم المستخدم بدون @"></div>
                <div class="form-group"><label class="small-muted" style="display:block;margin-bottom:6px;">رقم الهاتف</label><input type="tel" id="phone" class="form-control" placeholder="رقم الهاتف للتواصل"></div>
                <div class="form-group"><label class="small-muted" style="display:block;margin-bottom:6px;">صورة إيصال الدفع</label><input type="file" id="receipt" class="form-control" accept="image/*"></div>
                <button class="btn" style="width:100%;" onclick="submitOrder()">تأكيد الطلب</button>
            </div>
        </div>
    </div>

    <footer>
        <p>© Roma Shop</p>
    </footer>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
      // ======================================================
      // تكوين Firebase - استخدم بيانات مشروعك أو اتركها كما هي
      // ======================================================
      const firebaseConfig = {
        apiKey: "AIzaSyA-Pi_g3EUeSgOeVii_OqodpDguMMyPknY",
        authDomain: "romalshop.firebaseapp.com",
        projectId: "romalshop",
        storageBucket: "romalshop.firebasestorage.app",
        messagingSenderId: "830369715807",
        appId: "1:830369715807:web:fbfde9ded9daac6eb46dea"
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
      const storage = firebase.storage();

      // state
      let selectedPackage = { amount: 100, price: 20 };

      // الصفحة
      function showPage(pageId){
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        if(pageId === 'ordersPage'){ loadOrders(); }
      }

      // اختيار باقة (لازم تسجيل دخول)
      function selectPackage(amount, price){
        if(!auth.currentUser){
          alert('سجل دخول أو أنشئ حساب أولاً');
          showPage('loginPage');
          return;
        }
        selectedPackage = { amount, price };
        document.getElementById('selectedPackageInfo').textContent = `باقة ${amount} متابع - ${price} جنيه`;
        showPage('paymentPage');
      }

      // تسجيل حساب جديد
      async function signupUser(){
        const email = document.getElementById('signupEmail').value.trim();
        const pass = document.getElementById('signupPassword').value;
        const passConfirm = document.getElementById('signupPasswordConfirm').value;
        if(!email || !pass || !passConfirm){ alert('املأ كل الحقول'); return; }
        if(pass !== passConfirm){ alert('كلمة المرور وتأكيدها مش متطابقين'); return; }
        try{
          await auth.createUserWithEmailAndPassword(email, pass);
          alert('تم إنشاء الحساب بنجاح');
          // بعد التسجيل نذهب للصفحة الرئيسية
          showPage('homePage');
        }catch(e){
          alert('خطأ في التسجيل: ' + e.message);
        }
      }

      // تسجيل دخول
      async function loginUser(){
        const email = document.getElementById('loginEmail').value.trim();
        const pass = document.getElementById('loginPassword').value;
        if(!email || !pass){ alert('املأ البريد وكلمة المرور'); return; }
        try{
          await auth.signInWithEmailAndPassword(email, pass);
          showPage('homePage');
        }catch(e){
          alert('خطأ في تسجيل الدخول: ' + e.message);
        }
      }

      // تسجيل خروج
      function logoutUser(){
        auth.signOut()
          .then(()=> {
            // بعد تسجيل الخروج نتحول لصفحة تسجيل الدخول
            showPage('loginPage');
          })
          .catch(e => alert('خطأ أثناء الخروج: ' + e.message));
      }

      // إرسال طلب (يرفع الإيصال للـ Storage ويحفظ المستند في Firestore)
      async function submitOrder(){
        if(!auth.currentUser){ alert('سجل دخول قبل إرسال الطلب'); showPage('loginPage'); return; }

        const username = document.getElementById('username').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const receiptFile = document.getElementById('receipt').files[0];
        if(!username || !phone || !receiptFile){ alert('يرجى ملء كل الحقول وإرفاق صورة الإيصال'); return; }

        try{
          // رفع الصورة للـ Storage
          const storageRef = storage.ref();
          const receiptRef = storageRef.child(`receipts/${auth.currentUser.uid}_${Date.now()}_${receiptFile.name}`);
          const uploadTask = await receiptRef.put(receiptFile);
          const receiptURL = await uploadTask.ref.getDownloadURL();

          // حفظ الطلب
          await db.collection('orders').add({
            package: selectedPackage,
            username,
            phone,
            receiptURL,
            userId: auth.currentUser.uid,
            status: 'قيد المراجعة',
            date: new Date().toLocaleDateString('ar-EG'),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });

          alert('تم تقديم طلبك بنجاح! سيتم مراجعته قريباً.');
          // إعادة تعيين الحقول
          document.getElementById('username').value = '';
          document.getElementById('phone').value = '';
          document.getElementById('receipt').value = '';
          showPage('ordersPage');
        }catch(e){
          console.error(e);
          alert('حدث خطأ أثناء إرسال الطلب: ' + e.message);
        }
      }

      // تحميل طلبات المستخدم
      async function loadOrders(){
        const ordersList = document.getElementById('ordersList');
        ordersList.innerHTML = '<p style="text-align:center;opacity:0.8">جاري التحميل...</p>';
        if(!auth.currentUser){
          ordersList.innerHTML = '<div style="text-align:center;padding:20px;"><p>سجل دخول لعرض طلباتك</p></div>';
          return;
        }
        try{
          const snapshot = await db.collection('orders')
            .where('userId', '==', auth.currentUser.uid)
            .orderBy('timestamp', 'desc')
            .get();

          if(snapshot.empty){
            ordersList.innerHTML = `<div style="text-align:center;padding:40px;background:rgba(255,255,255,0.03);border-radius:12px;"><i class="fas fa-shopping-bag" style="font-size:36px;opacity:0.5;"></i><h3 style="margin-top:12px;">لا توجد طلبات حالياً</h3><p class="small-muted">بمجرد إرسال طلبك سيظهر هنا</p></div>`;
            return;
          }

          let html = '';
          snapshot.forEach(doc => {
            const o = doc.data();
            const statusClass = o.status === 'تم الإرسال' ? 'status-completed' : 'status-pending';
            html += `
              <div class="order-item">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                  <div>
                    <strong>طلب #${doc.id.slice(-6)}</strong>
                    <p class="small-muted" style="margin-top:6px;">${o.package.amount} متابع - ${o.package.price} جنيه</p>
                  </div>
                  <span class="${statusClass}">${o.status}</span>
                </div>
                <p><strong>اسم المستخدم:</strong> @${o.username}</p>
                <p><strong>رقم الهاتف:</strong> ${o.phone}</p>
                <p><strong>تاريخ الطلب:</strong> ${o.date}</p>
                ${o.receiptURL ? `<p><a href="${o.receiptURL}" target="_blank" style="color:var(--accent);">عرض إيصال الدفع</a></p>` : ''}
              </div>
            `;
          });
          ordersList.innerHTML = html;
        }catch(e){
          console.error(e);
          ordersList.innerHTML = '<p style="text-align:center;color:var(--danger)">حدث خطأ في تحميل الطلبات</p>';
        }
      }

      // التنقل الآمن: لو حاول المستخدم يفتح الصفحة ولا هو مسجل، نعرض صفحة login
      function goToOrders(){
        if(auth.currentUser){
          loadOrders();
          showPage('ordersPage');
        } else {
          alert('سجل دخول أو سجّل حساب أولاً');
          showPage('loginPage');
        }
      }

      // مراقبة حالة المستخدم
      auth.onAuthStateChanged(user => {
        const navLogin = document.getElementById('navLogin');
        const navSignup = document.getElementById('navSignup');
        const navLogout = document.getElementById('navLogout');

        if(user){
          // مخفي تسجيل دخول/سجل، وبان تسجيل الخروج
          if(navLogin) navLogin.style.display = 'none';
          if(navSignup) navSignup.style.display = 'none';
          if(navLogout) navLogout.style.display = 'inline-block';
          // افتراضي نعرض الصفحة الرئيسية لو مش في صفحة أخرى
          // لو المستخدم في صفحة تسجيل أو تسجيل جديد نرجعه للصفحة الرئيسية
          const active = document.querySelector('.page.active');
          if(active && (active.id === 'loginPage' || active.id === 'signupPage')) showPage('homePage');
        } else {
          if(navLogin) navLogin.style.display = 'inline-block';
          if(navSignup) navSignup.style.display = 'inline-block';
          if(navLogout) navLogout.style.display = 'none';
          // لو مفيش يوزر نظهر صفحة تسجيل الدخول
          showPage('loginPage');
        }
      });

      // لو الصفحة اتفتحت لأول مرة
      document.addEventListener('DOMContentLoaded', function(){
        console.log('Roma Shop loaded');
      });
    </script>
</body>
</html>
